<!DOCTYPE html>
<html>
<head>
    <title>Micro-Facial Expression Detection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .detection-card { background: rgba(255,255,255,0.9); border-radius: 15px; }
        .truth { color: #28a745; font-weight: bold; }
        .lie { color: #dc3545; font-weight: bold; }
        #video-container { border: 3px solid #fff; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <h1 class="text-center text-white mb-4">Micro-Facial Expression Detection</h1>
        <p class="text-center text-white mb-4">Real-time Lie/Truth Detection System</p>
        
        <div class="row">
            <div class="col-md-8">
                <div class="detection-card p-3 mb-4">
                    <h3 class="text-center mb-3">Live Detection</h3>
                    <div id="video-container" class="text-center">
                        <img id="video-feed" src="{{ url_for('video_feed') }}" class="img-fluid">
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="detection-card p-3">
                    <h4 class="text-center mb-3">Detection Results</h4>
                    <div id="results-area">
                        <div class="alert alert-info">
                            <strong>Status:</strong> <span id="status">Monitoring...</span>
                        </div>
                        <div id="detection-history"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        let detectionCount = {truth: 0, lie: 0};
        
        setInterval(function() {
            $.getJSON('/detections', function(data) {
                updateResults(data);
            });
        }, 500);

        function updateResults(detections) {
            if (detections.length > 0) {
                let latest = detections[0];
                $('#status').text(`Detected: ${latest.label} (${(latest.confidence * 100).toFixed(1)}%)`);
                $('#status').removeClass('truth lie').addClass(latest.label.toLowerCase());
                
                detectionCount[latest.label.toLowerCase()]++;
                updateHistory();
            }
        }

        function updateHistory() {
            let total = detectionCount.truth + detectionCount.lie;
            let truthPercent = total > 0 ? (detectionCount.truth / total * 100).toFixed(1) : 0;
            let liePercent = total > 0 ? (detectionCount.lie / total * 100).toFixed(1) : 0;
            
            $('#detection-history').html(`
                <div class="mt-3">
                    <h6>Session Statistics:</h6>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-success" style="width: ${truthPercent}%">${truthPercent}% Truth</div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar bg-danger" style="width: ${liePercent}%">${liePercent}% Lie</div>
                    </div>
                    <small class="text-muted">Total detections: ${total}</small>
                </div>
            `);
        }
    </script>
</body>
</html>